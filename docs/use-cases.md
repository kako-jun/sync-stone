# ユースケース

SyncStoneの動作はページ種別と所有者によって異なる。

## ページ種別による動作

### 1. ロドスト以外のページ

**例**: `https://google.com`、`https://example.com`

**動作**:
- ガイダンスメッセージを表示（ロドストへのリンク付き）
- エクスポートボタンは非表示
- 設定欄は非表示

### 2. ロドストのキャラクターページ（ブログ以外）

**例**:
- プロフィール: `/lodestone/character/12345/`
- フリーカンパニー: `/lodestone/character/12345/freecompany/`
- マウント: `/lodestone/character/12345/mount/`

**動作**:
- ガイダンスメッセージを表示
- エクスポートボタンは非表示

### 3. ブログ一覧ページ（1ページ目）

**URL**: `/lodestone/character/12345/blog/` または `/lodestone/character/12345/blog/?page=1`

**動作**:
- 「☄ すべての記事をエクスポート」ボタン表示
- 「この記事をエクスポート」ボタンは非表示
- アクセス間隔設定が表示

**処理フロー**:
1. ボタンクリック
2. 全ページの記事を収集（進捗表示）
3. 確認ダイアログ「N件の記事をエクスポートしますか？」
4. 「はい」で全記事エクスポート開始

### 4. ブログ一覧ページ（2ページ目以降）

**URL**: `/lodestone/character/12345/blog/?page=2`

**動作**:
- 「1ページ目へ移動 → すべての記事をエクスポート」ボタン表示
- 「この記事をエクスポート」ボタンは非表示

**処理フロー**:
1. ボタンクリック
2. 自動的に1ページ目へ移動
3. 以降は「3. ブログ一覧ページ（1ページ目）」と同じ

### 5. 個別記事ページ

**URL**: `/lodestone/character/12345/blog/67890`

**動作**:
- 「1ページ目へ移動 → すべての記事をエクスポート」ボタン表示
- 「📝 この記事をエクスポート」ボタン表示
- 記事情報を表示（タイトル、本文長、画像数、いいね数、コメント数）

**単一記事エクスポートの処理フロー**:
1. 「この記事をエクスポート」ボタンクリック
2. 記事内の画像をダウンロード
3. Markdownに変換
4. ZIPファイルをダウンロード（`記事タイトル.zip`）

**全記事エクスポートの処理フロー**:
1. 「1ページ目へ移動 → すべての記事をエクスポート」ボタンクリック
2. 自動的にブログ一覧の1ページ目へ移動
3. 以降は「3. ブログ一覧ページ（1ページ目）」と同じ

### 6. 記事編集ページ

**URL**: `/lodestone/character/12345/blog/67890/edit`

**動作**:
- ガイダンスメッセージを表示
- エクスポートボタンは非表示

## 自分のブログ vs 他人のブログ

### 判定方法

```typescript
// body要素に id="community" があれば他人のブログ
const isOwnBlog = !document.body.hasAttribute('id') ||
                  document.body.getAttribute('id') !== 'community';
```

### 動作の違い（全記事エクスポート時）

| 項目 | 自分のブログ | 他人のブログ |
|------|-------------|-------------|
| **Phase 0** | `/my/image/`から全画像収集 | スキップ |
| **取得できる画像** | 画像一覧 + 記事内画像 | 記事内画像のみ |
| **ZIPファイル名** | `lodestone_complete_export.zip` | `lodestone_others_complete_export.zip` |
| **確認ダイアログ** | `（自分の記事）` | `（自分以外の記事）` |

### 理由

- `/my/image/`は自分専用ページで他人はアクセス不可
- 自分のブログは記事未使用の画像も含めて完全バックアップ可能
- 他人のブログは記事本文内の画像のみが対象

## 全記事エクスポートの処理フェーズ

### 自分のブログの場合

```
Phase 0: 画像一覧収集（/my/image/）
    ↓
Phase 1: 各記事ページから詳細情報を抽出
    ↓
Phase 2: 記事内の追加画像をダウンロード
    ↓
Phase 3: 統合ZIP生成・ダウンロード
```

### 他人のブログの場合

```
Phase 0: スキップ
    ↓
Phase 1: 各記事ページから詳細情報を抽出
    ↓
Phase 2: 記事内の画像をダウンロード
    ↓
Phase 3: 統合ZIP生成・ダウンロード
```

## 出力ファイル構成

### 単一記事エクスポート

```
記事タイトル.zip
├── 001_記事タイトル.md
└── images/
    └── (画像ファイル)
```

### 全記事エクスポート

```
lodestone_complete_export.zip  (または lodestone_others_complete_export.zip)
├── 001_記事タイトル1.md
├── 002_記事タイトル2.md
├── ...
├── index.md          # 記事一覧（リンク集）
└── images/
    ├── a1b2c3d4_image1.jpg
    └── ...
```

## 対応リージョン

以下のロドストURLに対応:

| リージョン | URL |
|-----------|-----|
| 日本 | `https://jp.finalfantasyxiv.com/lodestone/` |
| 北米 | `https://na.finalfantasyxiv.com/lodestone/` |
| 欧州 | `https://eu.finalfantasyxiv.com/lodestone/` |
| フランス | `https://fr.finalfantasyxiv.com/lodestone/` |
| ドイツ | `https://de.finalfantasyxiv.com/lodestone/` |
