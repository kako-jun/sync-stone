# SyncStone Chrome拡張機能 - 開発の振り返り

このドキュメントは、SyncStone Chrome拡張機能の開発プロセスにおける主要な決定事項と、kako-junからのフィードバックによる方針転換の経緯を記録します。

## 1. 初期構想とCLI連携の検討

開発当初、SyncStoneはChrome拡張機能とRust製のCLIバイナリをNative Messagingで連携させる構想でした。主な目的は以下の通りです。

*   **ファイルの安全なローカル保存**: ブラウザ拡張機能単体では難しい、柔軟なファイル構造での保存や、添付画像のダウンロード・管理をCLIで行う。
*   **ロドスト記法からMarkdownへの堅牢な変換**: 複雑な変換ロジックをRustで実装し、パフォーマンスと堅牢性を確保する。
*   **将来的な拡張性**: ローカルでの記事閲覧UIや、インポート機能など、CLIを介した高度な機能拡張を見据える。

## 2. 方針転換：Chrome拡張機能単体での完結

kako-junからの、エクスポート機能はChrome拡張機能単体で完結させるべきであるというご意見を受け、CLI連携の必要性を再検討しました。

議論の結果、以下の理由からChrome拡張機能単体での完結を目指す方針に転換しました。

*   **利用者の利便性**: CLIのインストールやNative Messagingの設定は、一般の利用者にとってハードルが高い。拡張機能単体で完結することで、導入の敷居が大幅に下がる。
*   **開発の簡素化**: 連携部分の実装・デバッグコストを削減できる。
*   **主要機能の実現可能性**: 画像のダウンロードやZIP化、HTMLからMarkdownへの変換といった主要機能は、Chrome拡張機能のAPIとJavaScriptライブラリ（JSZip, Turndown）で十分に実現可能であると判断した。

この方針転換により、Rust CLI関連のファイルは削除されました。

## 3. 主要機能の実装と改善

Chrome拡張機能単体での開発を進める中で、以下の機能が実装・改善されました。

*   **Markdown変換の強化**: Turndownライブラリを導入し、HTMLからMarkdownへの変換精度を向上させた。
*   **画像処理の改善**: 初期は画像リンクのみだったが、kako-junからのフィードバックを受け、ロドスト内部の画像をダウンロードし、ZIPファイルに含めるように変更。さらに、画像一覧ページから一括で画像をダウンロードし、ユニークなファイル名で保存することで、重複保存とファイル名衝突の問題を解決した。
*   **コメント本文の取得**: コメントの数だけでなく、コメント本文も取得し、Markdownファイルに含めるようにした。
*   **メタデータの追加**: 記事の公開日時やタグなどのメタデータをYAMLフロントマター形式でMarkdownファイルに含めることで、データの整理と再利用性を高めた。
*   **記事一覧の生成**: エクスポートされた記事へのリンク集となる`記事一覧.md`を生成し、ローカルでの閲覧性を向上させた。
*   **ユーザーインターフェースの改善**: 全記事エクスポート前に確認ダイアログを表示し、エクスポート中は進捗バーを表示することで、利用者の体験を向上させた。
*   **アクセス間隔の設定**: サーバー負荷への配慮から導入したアクセス間隔を拡張機能の利用者が設定できるようにし、かつ最低2秒の制約を設けることで、安全性を確保した。

## 4. ドキュメントの整備

開発の最終段階で、`README.md`を詳細に整備し、拡張機能の機能、インストール方法、使用方法、注意事項などを明確に記述しました。特に、kako-junからのご指摘を受け、表現の調整を行いました。一部の記述が利用者に誤解を与える可能性があったため、より分かりやすく、安心して利用できる説明を目指しました。

## 開発を終えての感想

本プロジェクトは、kako-junからの具体的なフィードバックを直接開発プロセスに反映させることで、より実用的で利用者に優しいツールへと進化しました。

ロドストのHTML構造に依存する部分が多いため、将来的な仕様変更には追従が必要となる可能性がありますが、現在の実装で利用者の「大切な思い出をバックアップする」という目的は十分に達成できるものと確信しています。Markdownと画像というポータブルな形式でデータを保存することで、利用者は自身のデータを自由に管理できるようになります。これは、本プロジェクトの最も重要な成果だと考えます。